<<<<<<< HEAD
[{"id":"e4d1ab07.0e2f88","type":"tab","label":"chiller status check","disabled":false,"info":""},{"id":"dff35071.aba68","type":"serial-port","z":"","serialport":"/dev/ttyACM0","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","waitfor":"S","dtr":"none","rts":"none","cts":"none","dsr":"none","newline":"1000","bin":"false","out":"interbyte","addchar":"","responsetimeout":"1000"},{"id":"3b0d68ae.3c7c58","type":"serial-port","z":"","serialport":"/dev/ttyUSB0","serialbaud":"115200","databits":"8","parity":"none","stopbits":"1","waitfor":"","newline":"300","bin":"false","out":"time","addchar":"\\r","responsetimeout":"300"},{"id":"502cb4b1.a3ee6c","type":"ui_tab","z":"","name":"Process Safety Equipment Charts","icon":"dashboard","disabled":false,"hidden":false},{"id":"ced3172c.609d68","type":"ui_group","z":"","name":"Huber","tab":"502cb4b1.a3ee6c","disp":true,"width":"6","collapse":false},{"id":"aa250bb5.0c5068","type":"serial request","z":"e4d1ab07.0e2f88","name":"chiller","serial":"dff35071.aba68","x":450,"y":160,"wires":[["17489e36.847782","989454ea.a7dbd8","27dfb373.e590ac"]]},{"id":"1a565c39.20cd84","type":"inject","z":"e4d1ab07.0e2f88","name":"timer","topic":"","payload":"","payloadType":"date","repeat":"60","crontab":"","once":true,"onceDelay":"1","x":130,"y":160,"wires":[["88b61ea7.7c4bc"]]},{"id":"88b61ea7.7c4bc","type":"function","z":"e4d1ab07.0e2f88","name":"command","func":"msg.payload = \"SP?\\r\\n\";\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":160,"wires":[["aa250bb5.0c5068"]]},{"id":"17489e36.847782","type":"mqtt out","z":"e4d1ab07.0e2f88","name":"","topic":"","qos":"","retain":"","x":610,"y":160,"wires":[]},{"id":"68703e86.eaeb3","type":"ui_chart","z":"e4d1ab07.0e2f88","name":"Temperature","group":"ced3172c.609d68","order":0,"width":0,"height":0,"label":"Set Point","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":770,"y":100,"wires":[[]]},{"id":"989454ea.a7dbd8","type":"function","z":"e4d1ab07.0e2f88","name":"format","func":"msg.payload = Number(msg.payload.slice(4, 7)) + Number(msg.payload.slice(7, 9));\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":100,"wires":[["68703e86.eaeb3"]]},{"id":"27dfb373.e590ac","type":"debug","z":"e4d1ab07.0e2f88","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":630,"y":220,"wires":[]}]
=======
[{"id":"aef23086.5a967","type":"tab","label":"TCU:1","disabled":false,"info":""},{"id":"ee4ec4ca.98ca88","type":"function","z":"aef23086.5a967","name":"make command","func":"let value = String(msg.payload.value);\nswitch (msg.payload.command) {\n    case \"POWER:SP\":\n        // Default to off\n        let power = value == \"ON\" ? \"1\" : \"0\"\n        node.send({\n            \"payload\": \"out_mode_05 \" + power + \" \\r\"\n        });\n        break;\n    case \"MODE:SP\":\n        // Default to bath\n        let mode = value == \"SENSOR\" ? \"1\" : \"0\"\n        node.send({\n            \"payload\": \"out_mode_05 0 \\r\"\n        })\n        setTimeout(function() {\n            node.send({\n                \"payload\": \"out_mode_04 \" + mode + \" \\r\",\n                \"topic\": msg.topic\n            })\n        }, 300);    \n        setTimeout(function() {\n            node.send({\n                \"payload\": \"out_mode_05 1 \\r\"\n            });\n        }, 600);\n        break;\n    case \"TEMP0:SP\":\n        node.send({\n            \"payload\": \"out_sp_00 \" + value + \" \\r\"\n        });\n        break;\n    case \"TEMP1:SP\":\n        node.send({\n            \"payload\": \"out_sp_01 \" + value + \" \\r\"\n        });\n        break;\n    case \"TEMP2:SP\":\n        node.send({\n            \"payload\": \"out_sp_02 \" + value + \" \\r\"\n        });\n        break;\n    case \"WORKING:SP\":\n        node.send({\n            \"payload\": \"out_mode_01 \" + value + \" \\r\"\n        });\n        break;\n    case \"BATH:TEMP:PV\":\n        node.send({\n            \"payload\": \"in_pv_00 \\r\"\n        });\n        break;\n    case \"SENSOR:TEMP:PV\":\n        node.send({\n            \"payload\": \"in_pv_03 \\r\"\n        });\n        break;\n    default:\n        break;\n}","outputs":1,"noerr":0,"x":560,"y":260,"wires":[[]]},{"id":"4836ce11.cbfda","type":"function","z":"aef23086.5a967","name":"format response","func":"let value = Number(msg.payload.toString(\"utf8\")).toFixed(1);\nmsg.payload = flow.get(\"payload\");\nmsg.topic = flow.get(\"topic\");\nmsg.payload.value = value;\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":260,"wires":[["36c61a6c.4a2586"]]},{"id":"414dabcf.2a96c4","type":"delay","z":"aef23086.5a967","name":"limit msg rate","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"0.5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":130,"y":260,"wires":[["5e8ee0b0.8c74d"]]},{"id":"5e8ee0b0.8c74d","type":"function","z":"aef23086.5a967","name":"set flow variables","func":"flow.set(\"payload\", msg.payload);\nflow.set(\"topic\", msg.topic);\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":260,"wires":[["ee4ec4ca.98ca88"]]},{"id":"36c61a6c.4a2586","type":"link out","z":"aef23086.5a967","name":"TCU:1 flow out","links":["e497f18e.96f0c","103ee750.a13759"],"x":1015,"y":260,"wires":[]},{"id":"6c031c01.b894b4","type":"mqtt in","z":"aef23086.5a967","name":"incoming","topic":"SP","qos":"2","datatype":"auto","broker":"","x":220,"y":480,"wires":[[]]},{"id":"8efae259.20cbb","type":"inject","z":"aef23086.5a967","name":"bath temp","topic":"BATH:TEMP:PV","payload":"BATH:TEMP:PV","payloadType":"str","repeat":"1","crontab":"","once":true,"onceDelay":0.1,"x":210,"y":380,"wires":[[]]},{"id":"8f354271.d4b56","type":"inject","z":"aef23086.5a967","name":"sensor temp","topic":"SENSOR:TEMP:PV","payload":"SENSOR:TEMP:PV","payloadType":"str","repeat":"1","crontab":"","once":true,"onceDelay":"0.5","x":200,"y":420,"wires":[[]]},{"id":"80f4e17a.7a707","type":"function","z":"aef23086.5a967","name":"make command","func":"let value = String(msg.payload.value);\nswitch (msg.payload.command) {\n    case \"POWER:SP\":\n        // Default to off\n        let power = value == \"ON\" ? \"1\" : \"0\"\n        node.send({\n            \"payload\": \"out_mode_05 \" + power + \" \\r\"\n        });\n        break;\n    case \"MODE:SP\":\n        // Default to bath\n        let mode = value == \"SENSOR\" ? \"1\" : \"0\"\n        node.send({\n            \"payload\": \"out_mode_05 0 \\r\"\n        })\n        setTimeout(function() {\n            node.send({\n                \"payload\": \"out_mode_04 \" + mode + \" \\r\",\n                \"topic\": msg.topic\n            })\n        }, 300);    \n        setTimeout(function() {\n            node.send({\n                \"payload\": \"out_mode_05 1 \\r\"\n            });\n        }, 600);\n        break;\n    case \"TEMP0:SP\":\n        node.send({\n            \"payload\": \"out_sp_00 \" + value + \" \\r\"\n        });\n        break;\n    case \"TEMP1:SP\":\n        node.send({\n            \"payload\": \"out_sp_01 \" + value + \" \\r\"\n        });\n        break;\n    case \"TEMP2:SP\":\n        node.send({\n            \"payload\": \"out_sp_02 \" + value + \" \\r\"\n        });\n        break;\n    case \"WORKING:SP\":\n        node.send({\n            \"payload\": \"out_mode_01 \" + value + \" \\r\"\n        });\n        break;\n    case \"BATH:TEMP:PV\":\n        node.send({\n            \"payload\": \"in_pv_00 \\r\"\n        });\n        break;\n    case \"SENSOR:TEMP:PV\":\n        node.send({\n            \"payload\": \"in_pv_03 \\r\"\n        });\n        break;\n    default:\n        break;\n}","outputs":1,"noerr":0,"x":800,"y":420,"wires":[[]]},{"id":"49dbe9ca.062068","type":"delay","z":"aef23086.5a967","name":"limit serial","pauseType":"queue","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":".4","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":600,"y":420,"wires":[[]]},{"id":"e70c6629.a0d738","type":"function","z":"aef23086.5a967","name":"set topic","func":"msg.topic = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":480,"wires":[[]]}]
>>>>>>> master
